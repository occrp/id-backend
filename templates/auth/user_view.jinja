{% extends "crud/item_base.jinja" %}
{% macro render_ticket_table(tickets) %}
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>{% trans %}Summary{% endtrans %}</th>
                    <th>{% trans %}Type{% endtrans %}</th>
                    <th>{% trans %}Status{% endtrans %}</th>
                    <th>{% trans %}Deadline{% endtrans %}</th>
                    <th>{% trans %}Actions{% endtrans %}</th>
                </tr>
            </thead>
            <tbody>
                {% for ticket in tickets %}
                    <tr>
                        <td>
                            <a href="{{ uri_for('request_details', ticket_id=ticket.key.id()) }}">
                                {{ ticket.summary }}
                            </a>
                        </td>
                        <td>{{ ticket.ticket_type_display() }}</td>
                        <td>
			  {% if ticket.status == 'new' %}

			  {% trans %} Unassigned {% endtrans %}

			  {% elif ticket.status == 'in-progress' %}

			  {% if ticket.responders_len > 0 %}
			        Assigned to
	      <a href="/admin/userprofile/{{ ticket.responders[0].get().key.urlsafe()}}/view">
			  {{ticket.responders[0].get().display_name}}</a>
                            {% else %}
                                {% trans %}No Responder{% endtrans %}
                            {% endif %}

			  {% elif ticket.status == 'closed' %}
			    {% trans %}Completed {% endtrans %}
			  {% elif ticket.status == 'cancelled' %}
			    {% trans %}Cancelled {% endtrans %}			  
			  {% endif %}


                        </td>
                        <td>{{ macros.display_datetime(ticket.deadline) }}</td>
                        <td>
                            <a class='btn btn-mini' href="{{ uri_for('ticket_edit', ticket_id=ticket.key.id()) }}?next={{ request.path_qs }}">
                                <i class="icon-pencil"></i>
                            </a>
                        </td>
                    </tr>
                {% endfor %}

            </tbody>
        </table>
{% endmacro %}


{% block subhead %}
{% endblock %}

{% block admin_content %}
        <h1>{% block crud_title %}View User Profile{% endblock %}</h1>
<h5>
        <a href="/admin/userprofile/{{user_profile.key.urlsafe()}}/edit/">Edit this profile</a>
</h5>

        <table class="table table-striped table-bordered {{ extra_class }}">
	        {% for label, value in elements %}
  	        {% if value %}
                <tr>
		  <td><b>
              {{ user_profile.__class__[label]._verbose_name }}  </b>
		  </td><td>{{value}}</td>
		  </tr>
		 {% endif %}
		 {% endfor %}
         </table>

	    <h3>Requests related to this user</h3>
    {{ render_ticket_table(tickets) }}
	    

{% endblock %}
